### **Проектирование Базы Данных: Authentication & Authorization Service (Auth Service)**

**Назначение сервиса:** Управление базовыми учетными записями для аутентификации, хешированием паролей, 2FA и сессиями/токенами.**Сущности и их Атрибуты:**

#### **1. Сущность: UserAccount (Базовая учетная запись для аутентификации)**

- **AccountID**
    - **Тип данных:** UUID (или VARCHAR(36))
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор учетной записи пользователя в рамках Auth Service.
- **Email**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Электронная почта пользователя, используется для входа и уникализации.
- **PasswordHash**
    - **Тип данных:**VARCHAR(255) (для bcrypt хеша)
    - **Обязательность:**NOT NULL
    - **Примечания:** Хешированный пароль пользователя (например, с использованием bcrypt).
- **PasswordSalt**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Примечания:** Уникальная "соль" для хеширования пароля (если используется алгоритм, требующий внешней соли, хотя bcrypt инкапсулирует её).
- **Is2FAEnabled**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг, указывающий, включена ли двухфакторная аутентификация для учетной записи.
- **EmailConfirmed**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг, указывающий, подтвержден ли адрес электронной почты пользователя.
- **CreatedAt**
    - **Тип данных:**DATETIME (или TIMESTAMP)
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** Текущее время
    - **Примечания:** Время создания учетной записи.
- **UpdatedAt**
    - **Тип данных:**DATETIME (или TIMESTAMP)
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** Текущее время
    - **Примечания:** Время последнего обновления учетной записи.

#### **2. Сущность: UserSession (Информация о текущих активных сессиях)**

- **SessionID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор сессии.
- **AccountID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserAccount.AccountID
    - **Примечания:** Ссылка на учетную запись, которой принадлежит сессия.
- **AccessToken**
    - **Тип данных:**VARCHAR(512) (или TEXT)
    - **Обязательность:**NOT NULL
    - **Примечания:** Сам JWT токен (если хранится для отзыва или валидации). В некоторых реализациях JWT токены не хранятся в БД, а валидируются криптографически. В нашем случае, поскольку мы говорим о сессиях, это может быть ID токена. Для MVP, можно хранить сам токен.
- **RefreshToken**
    - **Тип данных:**VARCHAR(512) (или TEXT)
    - **Обязательность:**NULL (опционально)
    - **Примечания:** Токен для обновления AccessToken.
- **ExpiresAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Время истечения срока действия сессии/токена.
- **IssuedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Время выдачи сессии/токена.
- **DeviceInfo**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Информация об устройстве (браузер, ОС), с которого была начата сессия.
- **IsTrustedDevice**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг для опции "Доверять этому устройству".

#### **3. Сущность: TwoFactorAuthSecret (Секреты для TOTP, информация о SMS/Email методах)**

- **TwoFAID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **AccountID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserAccount.AccountID, UNIQUE Index (один 2FA метод на аккаунт в один момент)
    - **Примечания:** Ссылка на учетную запись.
- **Method**
    - **Тип данных:**VARCHAR(50)
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип 2FA метода (SMS, TOTP, EMAIL).
- **SecretValue**
    - **Тип данных:**VARCHAR(255) (для TOTP, зашифрованный)
    - **Обязательность:**NULL (обязателен только для TOTP)
    - **Примечания:** Зашифрованный секретный ключ для TOTP. Для SMS/EMAIL может быть NULL, если логика отправки кода не требует хранения секрета здесь.
- **BackupCodes**
    - **Тип данных:**TEXT (или JSONB если поддерживается)
    - **Обязательность:**NULL
    - **Примечания:** Хешированные или зашифрованные резервные коды, разделенные запятыми или в виде массива. Должны быть одноразовыми.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

---

**Взаимосвязи внутри Authentication & Authorization Service:**

- UserAccount (1) --- (много) UserSession: Одна учетная запись может иметь много активных сессий.
- UserAccount (1) --- (1) TwoFactorAuthSecret: Одна учетная запись имеет один активный 2FA секрет/метод (или несколько, если поддерживается несколько методов 2FA одновременно, но для MVP - один).

### **Проектирование Базы Данных: User & Profile Service**

**Назначение сервиса:** Управление подробными профилями пользователей (фрилансеров и заказчиков), их портфолио, навыками, стилями и отзывами, которые они получили.**Сущности и их Атрибуты:**

#### **1. Сущность: UserProfile (Детальный профиль пользователя)**

- **UserID**
    - **Тип данных:** UUID (или VARCHAR(36))
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор профиля, соответствует AccountID из Auth Service (логическая связь, не FK на уровне БД).
- **Email**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Повторяет email из Auth Service для удобства поиска и связывания, но не является первичным ключом. Используется для внутренней логики сервиса.
- **FirstName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
- **LastName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
- **DisplayName**
    - **Тип данных:**VARCHAR(200)
    - **Обязательность:**NOT NULL
    - **Примечания:** Имя/псевдоним, отображаемый на публичных страницах.
- **ProfileType**
    - **Тип данных:**VARCHAR(50) (ENUM: 'FREELANCER', 'CUSTOMER')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип профиля (фрилансер или заказчик).
- **Country**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
- **PhoneNumber**
    - **Тип данных:**VARCHAR(50) (формат E.164)
    - **Обязательность:**NULL
    - **Примечания:** Номер телефона пользователя.
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Общее описание профиля/компании.
- **AvatarUrl**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NULL
    - **Примечания:** Ссылка на аватар/логотип.
- **AverageRating**
    - **Тип данных:**DECIMAL(3, 2) (например, 4.75)
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**0.00
    - **Примечания:** Средний рейтинг пользователя на основе полученных отзывов.
- **TotalReviewsCount**
    - **Тип данных:**INTEGER
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**0
    - **Примечания:** Общее количество полученных отзывов.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: PortfolioItem (Элементы портфолио - для фрилансеров)**

- **PortfolioItemID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserProfile.UserID
    - **Примечания:** Ссылка на владельца портфолио.
- **Title**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
- **ProjectURL**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NULL
    - **Примечания:** Ссылка на живой проект или репозиторий.
- **ImageUrl**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NULL
    - **Примечания:** Ссылка на изображение-превью или скриншот.
- **OrderAssociatedID**
    - **Тип данных:** UUID
    - **Oбязательность:**NULL
    - **Примечания:** Опциональная ссылка на ID заказа в Order & Project Service, если элемент портфолио связан с завершенным заказом на платформе (логическая связь).
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL

#### **3. Сущность: Skill (Навыки пользователя - для фрилансеров)**

- **SkillID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserProfile.UserID
- **SkillName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Например, "JavaScript", "UI/UX Design", "Copywriting".
- **ExperienceLevel**
    - **Тип данных:**VARCHAR(50) (ENUM: 'Beginner', 'Intermediate', 'Advanced')
    - **Обязательность:**NULL
    - **Примечания:** Уровень владения навыком.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL

#### **4. Сущность: WorkingStyle (Стили работы - для фрилансеров)**

- **StyleID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserProfile.UserID
- **StyleName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Например, "Minimalism", "Flat Design", "Agile", "Fixed Price".
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL

#### **5. Сущность: Review (Отзывы, оставленные _о_ пользователе)**

- **ReviewID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **AboutUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к UserProfile.UserID
    - **Примечания:** ID пользователя, о котором оставлен отзыв.
- **ByUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID пользователя, который оставил отзыв (логическая ссылка на UserProfile.UserID).
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID заказа, в рамках которого оставлен отзыв (логическая ссылка на Order.OrderID в Order & Project Service).
- **Rating**
    - **Тип данных:**DECIMAL(2,1) (например, 4.5)
    - **Обязательность:**NOT NULL
    - **Примечания:** Оценка (например, от 1.0 до 5.0).
- **Comment**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Oбязательность:**NOT NULL

**Взаимосвязи внутри User & Profile Service:**

- UserProfile (1) --- (много) PortfolioItem (Один пользователь может иметь много элементов портфолио)
- UserProfile (1) --- (много) Skill (Один пользователь может иметь много навыков)
- UserProfile (1) --- (много) WorkingStyle (Один пользователь может иметь много стилей работы)
- UserProfile (1) --- (много) Review (Один пользователь может получить много отзывов, т.е. AboutUserID ведет на UserProfile)

### **Проектирование Базы Данных: Roles & Permissions Service (Roles Service)**

**Назначение сервиса:** Управление ролями пользователей и связанными с ними разрешениями, обеспечивая ролевое управление доступом (RBAC) для всей платформы.**Сущности и их Атрибуты:**

#### **1. Сущность: Role (Справочник ролей)**

- **RoleID**
    - **Тип данных:** UUID (или VARCHAR(36))
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор роли.
- **RoleName**
    - **Тип данных:**VARCHAR(50)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Человекочитаемое название роли (например, 'FREELANCER', 'CUSTOMER', 'SUPPORT', 'ADMIN').
- **Description**
    - **Тиль данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Подробное описание роли.
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
    - **Примечания:** Позволяет деактивировать роль без её удаления.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: Permission (Справочник разрешений)**

- **PermissionID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **PermissionName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Уникальный программный код разрешения (например, 'CREATE_ORDER', 'VIEW_ANY_PROFILE', 'MANAGE_USERS', 'REPLY_TO_TICKET').
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Человекочитаемое описание действия, разрешенного данным правом.
- **Module**
    - **Тип данных:**VARCHAR(50)
    - **Обязательность:**NULL
    - **Примечания:** Модуль системы, к которому относится разрешение (например, 'ORDERS', 'USERS', 'SUPPORT'). Полезно для организации.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **3. Сущность: RolePermission (Связь между ролями и разрешениями)**

- **RolePermissionID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **RoleID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Role.RoleID
    - **Примечания:** Ссылка на роль.
- **PermissionID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Permission.PermissionID
    - **Примечания:** Ссылка на разрешение.
    - **Ключ:**UNIQUE Constraint на (RoleID, PermissionID) для предотвращения дублирования связей.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **4. Сущность: UserRole (Связь между пользователями и ролями)**

- **UserRoleID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID пользователя (логическая ссылка на UserProfile.UserID в User & Profile Service и UserAccount.AccountID в Auth Service).
- **RoleID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Role.RoleID
    - **Примечания:** Ссылка на роль, назначенную пользователю.
    - **Ключ:**UNIQUE Constraint на (UserID, RoleID) для предотвращения дублирования ролей для одного пользователя.
- **AssignedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Дата назначения роли.
- **ExpiresAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Если роли могут быть временными.

**Взаимосвязи внутри Roles & Permissions Service:**

- Role (1) --- (много) RolePermission (Одна роль может иметь много разрешений)
- Permission (1) --- (много) RolePermission (Одно разрешение может быть частью многих ролей)
- Role (1) --- (много) UserRole (Одна роль может быть назначена многим пользователям)
- UserRole (много) --- (1) UserID (Не является прямой FK на уровне БД, а логической связью с UserProfile/UserAccount, так как пользователь находится в другом сервисе).

### **Проектирование Базы Данных: Order & Project Service**

**Назначение сервиса:** Управление жизненным циклом заказов и проектов, откликами (бидами) фрилансеров на заказы, а также хранение истории изменений заказов.**Сущности и их Атрибуты:**

#### **1. Сущность: Order (Основной заказ/проект)**

- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор заказа.
- **CustomerID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
    - **Примечания:** ID заказчика (логическая ссылка на UserProfile.UserID в User & Profile Service).
- **FreelancerID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL (Заказчик сначала публикует, фрилансер выбирается позже)
    - **Ключ:**Indexed
    - **Примечания:** ID фрилансера, выбранного для выполнения заказа (логическая ссылка на UserProfile.UserID в User & Profile Service).
- **Title**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Примечания:** Название заказа/проекта.
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Подробное описание технического задания.
- **BudgetAmount**
    - **Тип данных:**DECIMAL(10, 2)
    - **Обязательность:**NOT NULL
    - **Примечания:** Предполагаемый или согласованный бюджет.
- **BudgetCurrency**
    - **Тип данных:**VARCHAR(3)
    - **Обязательность:**NOT NULL
    - **Примечания:** Валюта бюджета (например, 'RUB', 'USD').
- **Deadline**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Срок выполнения заказа.
- **CurrentStatus**
    - **Тип данных:**VARCHAR(50) (ENUM: 'PENDING_PAYMENT', 'PUBLISHED', 'IN_PROGRESS', 'PENDING_ACCEPTANCE', 'PAYOUT_PENDING', 'COMPLETED', 'CANCELED', 'ARCHIVED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'PENDING_PAYMENT'
    - **Примечания:** Текущий статус заказа.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **PublishedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Время фактической публикации заказа после оплаты комиссии.
- **CompletedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Время окончательного завершения заказа.

#### **2. Сущность: OrderTag (Связь заказа с тегами)**

- **OrderTagID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Order.OrderID
    - **Примечания:** Ссылка на заказ.
- **TagValue**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Значение тега (например, "React", "Python", "UI/UX", "Mobile", "Modern"). Для этого можно использовать справочник из Admin Service.
    - **Ключ:**UNIQUE Constraint на (OrderID, TagValue)
- **TagType**
    - **Тип данных:**VARCHAR(50) (ENUM: 'TECHNOLOGY', 'STYLE', 'CATEGORY')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип тега.

#### **3. Сущность: Bid (Отклик фрилансера на заказ)**

- **BidID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Order.OrderID
    - **Примечания:** Ссылка на заказ, на который был сделан отклик.
- **FreelancerID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
    - **Примечания:** ID фрилансера, оставившего отклик (логическая ссылка на UserProfile.UserID).
    - **Ключ:**UNIQUE Constraint на (OrderID, FreelancerID) (фрилансер может оставить только один отклик на один заказ).
- **ProposedBudgetAmount**
    - **Тип данных:**DECIMAL(10, 2)
    - **Обязательность:**NULL
    - **Примечания:** Предложенный бюджет фрилансера (может совпадать или отличаться от бюджета заказа).
- **ProposedBudgetCurrency**
    - **Тип данных:**VARCHAR(3)
    - **Обязательность:**NULL
- **ProposedDeadline**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Предложенные фрилансером сроки.
- **Comment**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Комментарий фрилансера к отклику, включая предложение альтернативных технологий.
- **BidStatus**
    - **Тип данных:**VARCHAR(50) (ENUM: 'PENDING', 'ACCEPTED', 'REJECTED', 'CANCELED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'PENDING'
    - **Примечания:** Статус отклика.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **4. Сущность: OrderHistory (История изменений заказа)**

- **HistoryID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Order.OrderID
- **ActionType**
    - **Тип данных:**VARCHAR(100) (ENUM: 'CREATED', 'STATUS_CHANGED', 'BID_ACCEPTED', 'FILES_UPLOADED', 'ACCEPTED_BY_CUSTOMER', 'PAYOUT_INITIATED', 'COMPLETED')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип произошедшего действия.
- **ActorID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL (Может быть системное действие)
    - **Примечания:** ID пользователя, который совершил действие (логическая ссылка на UserProfile.UserID).
- **OldValue**
    - **Тип данных:**TEXT (или JSONB)
    - **Обязательность:**NULL
    - **Примечания:** Предыдущее значение измененного поля (например, старый статус).
- **NewValue**
    - **Тип данных:**TEXT (или JSONB)
    - **Обязательность:**NULL
    - **Примечания:** Новое значение измененного поля (например, новый статус).
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Время, когда произошло изменение.

**Взаимосвязи внутри Order & Project Service:**

- Order (1) --- (много) OrderTag (Один заказ может иметь много тегов)
- Order (1) --- (много) Bid (Один заказ может иметь много откликов)
- Order (1) --- (много) OrderHistory (Один заказ имеет много записей в истории)

### **Проектирование Базы Данных: Messenger Service**

**Назначение сервиса:** Управление обменом сообщениями между участниками проектов, включая хранение истории переписки и вложений.**Сущности и их Атрибуты:**

#### **1. Сущность: Conversation (Диалог/Тред)**

- **ConversationID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор диалога. В нашем случае, скорее всего, один диалог = один заказ.
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index (Один диалог на один заказ)
    - **Примечания:** Логическая ссылка на Order.OrderID в Order & Project Service.
- **Participant1UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID первого участника диалога (Заказчик или Фрилансер). Логическая ссылка на UserProfile.UserID.
- **Participant2UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID второго участника диалога. Логическая ссылка на UserProfile.UserID.
- **LastMessageAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL (до первого сообщения)
    - **Примечания:** Время последнего сообщения в диалоге, для сортировки.
- **Status**
    - **Тип данных:**VARCHAR(50) (ENUM: 'ACTIVE', 'ARCHIVED', 'CLOSED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'ACTIVE'
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: Message (Сообщение)**

- **MessageID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **ConversationID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Conversation.ConversationID
    - **Примечания:** Ссылка на диалог, к которому относится сообщение.
- **SenderUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID отправителя сообщения. Логическая ссылка на UserProfile.UserID.
- **MessageType**
    - **Тип данных:**VARCHAR(50) (ENUM: 'TEXT', 'ATTACHMENT', 'SYSTEM')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'TEXT'
- **TextContent**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL (если это сообщение-вложение или системное)
    - **Примечания:** Содержимое текстового сообщения.
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** Текущее время
    - **Ключ:**Indexed (для сортировки сообщений в диалоге).
- **IsRead** (для индикации прочтения, если требуется)
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE

#### **3. Сущность: Attachment (Вложение к сообщению)**

- **AttachmentID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **MessageID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Message.MessageID
    - **Примечания:** Ссылка на сообщение, к которому прикреплено вложение.
- **FileName**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
- **FileSizeKB**
    - **Тип данных:**INTEGER
    - **Обязательность:**NOT NULL
    - **Примечания:** Размер файла в килобайтах.
- **FileExtension**
    - **Тип данных:**VARCHAR(10)
    - **Обязательность:**NULL
    - **Примечания:** Например, 'png', 'pdf', 'zip'.
- **FileUrl**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Примечания:** URL файла в облачном хранилище (например, S3).
- **UploadedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

**Взаимосвязи внутри Messenger Service:**

- Conversation (1) --- (много) Message (Один диалог содержит много сообщений)
- Message (1) --- (много) Attachment (Одно сообщение может иметь много вложений)


### **Проектирование Базы Данных: Notification Service**

**Назначение сервиса:** Управление шаблонами уведомлений, их отправкой пользователям по различным каналам (email, внутрисистемные) и отслеживание истории доставки, а также пользовательские настройки уведомлений.**Сущности и их Атрибуты:**

#### **1. Сущность: NotificationTemplate (Шаблоны уведомлений)**

- **TemplateID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор шаблона.
- **TemplateName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Уникальное имя шаблона (например, 'USER_REGISTERED_EMAIL', 'NEW_MESSAGE_INAPP', 'ORDER_STATUS_CHANGED_SMS').
- **Channel**
    - **Тип данных:**VARCHAR(50) (ENUM: 'EMAIL', 'INAPP', 'SMS', 'PUSH' (для будущего))
    - **Обязательность:**NOT NULL
    - **Примечания:** Канал доставки уведомления.
- **Subject** (для Email/SMS)
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NULL
    - **Примечания:** Тема уведомления (для email или заголовка SMS).
- **Body**
    - **Тип данных:**TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Содержимое шаблона уведомления. Может содержать плейсхолдеры для динамических данных (например, {{userName}}, {{orderTitle}}).
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: NotificationLog (История отправленных уведомлений)**

- **NotificationLogID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
    - **Примечания:** Пользователь, которому было отправлено уведомление (логическая ссылка на UserProfile.UserID).
- **TemplateID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к NotificationTemplate.TemplateID
    - **Примечания:** Ссылка на использованный шаблон.
- **Channel**
    - **Тип данных:**VARCHAR(50) (ENUM: 'EMAIL', 'INAPP', 'SMS', 'PUSH')
    - **Обязательность:**NOT NULL
    - **Примечания:** Фактический канал, по которому было отправлено уведомление.
- **RecipientAddress**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Примечания:** Адрес получателя (email, номер телефона).
- **Status**
    - **Тип данных:**VARCHAR(50) (ENUM: 'SENT', 'DELIVERED', 'FAILED', 'PENDING')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'PENDING'
    - **Примечания:** Статус доставки уведомления.
- **SentAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **FailureReason**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Причина сбоя доставки, если применимо.
- **RelatedEntityID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** Ссылка на сущность, инициировавшую уведомление (например, OrderID, MessageID, TicketID).

#### **3. Сущность: UserNotificationSetting (Настройки уведомлений пользователя)**

- **SettingID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Unique Index (одна запись настроек на пользователя)
    - **Примечания:** Ссылка на пользователя.
- **NotificationType**
    - **Тип данных:**VARCHAR(100) (ENUM: 'USER_REGISTERED', 'NEW_MESSAGE', 'ORDER_STATUS_CHANGED', 'FUNDS_DEPOSITED', 'TICKET_UPDATED', 'ORDER_PUBLISHED' и т.д.)
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип события, для которого настраивается уведомление.
- **ReceiveEmail**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
    - **Примечания:** Получать ли уведомления по email.
- **ReceiveInApp**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
    - **Примечания:** Получать ли внутрисистемные уведомления.
- **ReceiveSMS**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Получать ли уведомления по SMS.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

**Взаимосвязи внутри Notification Service:**

- NotificationTemplate (1) --- (много) NotificationLog (Один шаблон может быть использован для множества отправленных уведомлений)
- UserNotificationSetting (много) --- (1) UserID (Не является прямой FK, а логической связью с UserProfile)

### **Проектирование Базы Данных: Payment Service**

**Назначение сервиса:** Управление счетами пользователей, обработка финансовых транзакций (пополнение, списание, начисление комиссии и премий), а также логирование всех финансовых операций.**Сущности и их Атрибуты:**

#### **1. Сущность: Account (Счет пользователя на платформе)**

- **AccountID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор счета.
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** ID пользователя, которому принадлежит счет (логическая ссылка на UserProfile.UserID в User & Profile Service).
- **BalanceAmount**
    - **Тип данных:**DECIMAL(18, 2)
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**0.00
    - **Примечания:** Текущий баланс счета. DECIMAL(18, 2) позволяет хранить большие суммы с точностью до двух знаков после запятой.
- **Currency**
    - **Тип данных:**VARCHAR(3)
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'RUB' (или 'USD' в зависимости от основной валюты платформы)
    - **Примечания:** Валюта счета (например, 'RUB', 'USD', 'EUR').
- **Status**
    - **Тип данных:**VARCHAR(50) (ENUM: 'ACTIVE', 'BLOCKED', 'CLOSED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'ACTIVE'
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: Transaction (Запись о каждой финансовой операции)**

- **TransactionID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **DebitedAccountID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Ключ:**Foreign Key (FK) к Account.AccountID
    - **Примечания:** ID счета, с которого были списаны средства (может быть NULL для пополнений).
- **CreditedAccountID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Ключ:**Foreign Key (FK) к Account.AccountID
    - **Примечания:** ID счета, на который были зачислены средства (может быть NULL для выводов).
- **Amount**
    - **Тип данных:**DECIMAL(18, 2)
    - **Обязательность:**NOT NULL
    - **Примечания:** Сумма операции.
- **Currency**
    - **Тип данных:**VARCHAR(3)
    - **Обязательность:**NOT NULL
- **Type**
    - **Тип данных:**VARCHAR(50) (ENUM: 'DEPOSIT', 'WITHDRAWAL', 'ORDER_PAYMENT', 'ORDER_BONUS', 'PLATFORM_FEE_DEBIT', 'PLATFORM_FEE_CREDIT', 'REFUND')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип финансовой операции.
- **Status**
    - **Тип данных:**VARCHAR(50) (ENUM: 'PENDING', 'COMPLETED', 'FAILED', 'REVERSED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'PENDING'
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **RelatedOrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID связанного заказа (логическая ссылка на Order.OrderID в Order & Project Service).
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Описание операции.
- **ReferenceID**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NULL
    - **Примечания:** ID внешней транзакции (если есть), ID платежа от агрегатора и т.п.
- **PlatformFeeAmount**
    - **Тип данных:**DECIMAL(18, 2)
    - **Обязательность:**NULL
    - **Примечания:** Сумма комиссии платформы, удержанная в рамках этой транзакции.
- **IsManual**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг, указывающий, была ли транзакция инициирована вручную администратором.

**Взаимосвязи внутри Payment Service:**

- Account (1) --- (много) Transaction (Один счет может быть участником многих транзакций как дебитор или кредитор)

### **Проектирование Базы Данных: Support & Dispute Service**

**Назначение сервиса:** Управление обращениями пользователей в службу поддержки, процессом их обработки, пересмотра и эскалации, а также модерацией отзывов.**Сущности и их Атрибуты:**

#### **1. Сущность: Ticket (Обращение пользователя)**

- **TicketID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор обращения.
- **SubmitterUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
    - **Примечания:** ID пользователя, подавшего обращение (логическая ссылка на UserProfile.UserID).
- **AssignedToUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Ключ:**Indexed
    - **Примечания:** ID сотрудника поддержки, которому назначено обращение (логическая ссылка на UserProfile.UserID).
- **Subject**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Примечания:** Тема обращения.
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Подробное описание проблемы.
- **CurrentStatus**
    - **Тип данных:**VARCHAR(50) (ENUM: 'NEW', 'OPEN', 'IN_PROGRESS', 'RESOLVED', 'DISPUTED', 'ESCALATED', 'CLOSED', 'ARCHIVED')
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:** 'NEW'
    - **Примечания:** Текущий статус обращения.
- **RelatedOrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Ключ:**Indexed
    - **Примечания:** ID связанного заказа, если обращение касается конкретного проекта (логическая ссылка на Order.OrderID).
- **DisputeCount**
    - **Тип данных:**INTEGER
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**0
    - **Примечания:** Счетчик оспариваний решения по обращению.
- **IsEscalatedToAdmin**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг, указывающий, было ли обращение эскалировано администратору.
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **ResolvedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Время решения обращения сотрудником поддержки.
- **ClosedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
    - **Примечания:** Время окончательного закрытия обращения.

#### **2. Сущность: TicketMessage (Сообщения в рамках обращения)**

- **TicketMessageID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **TicketID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Ticket.TicketID
    - **Примечания:** Ссылка на обращение.
- **SenderUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Примечания:** ID отправителя сообщения (пользователь или сотрудник поддержки). Логическая ссылка на UserProfile.UserID.
- **MessageContent**
    - **Тип данных:**TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Текст сообщения.
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed (для сортировки сообщений в треде).
- **IsInternal**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**FALSE
    - **Примечания:** Флаг, указывающий, является ли сообщение внутренним комментарием для сотрудников поддержки.

#### **3. Сущность: TicketLog (История изменений обращения)**

- **LogID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **TicketID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Foreign Key (FK) к Ticket.TicketID
- **ActionType**
    - **Тип данных:**VARCHAR(100) (ENUM: 'CREATED', 'ASSIGNED', 'STATUS_CHANGED', 'REPLIED', 'DISPUTED', 'ESCALATED_AUTO', 'ESCALATED_MANUAL', 'REVIEW_DELETED')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип произошедшего действия.
- **ActorUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID пользователя/сотрудника/админа, совершившего действие (логическая ссылка на UserProfile.UserID).
- **OldValue**
    - **Тип данных:**TEXT (или JSONB)
    - **Обязательность:**NULL
    - **Примечания:** Предыдущее значение измененного поля (например, старый статус).
- **NewValue**
    - **Тип данных:**TEXT (или JSONB)
    - **Обязательность:**NULL
    - **Примечания:** Новое значение измененного поля (например, новый статус или ID назначенного сотрудника).
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **4. Сущность: DisputeReason (Справочник причин для оспаривания/жалобы)**

- **ReasonID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **ReasonCode**
    - **Тип данных:**VARCHAR(50)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Короткий код причины (например, 'INCORRECT_DECISION', 'HARASSMENT').
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Полное описание причины.
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE

**Взаимосвязи внутри Support & Dispute Service:**

- Ticket (1) --- (много) TicketMessage (Одно обращение имеет много сообщений)
- Ticket (1) --- (много) TicketLog (Одно обращение имеет много записей в истории)
- DisputeReason (1) --- (много) Ticket (Одно обращение может быть связано с одной причиной оспаривания, хотя Ticket не хранит FK, а сам текст)

### **Проектирование Базы Данных: Analytics & Reporting Service**

**Назначение сервиса:** Сбор, агрегация и хранение ключевых метрик активности пользователей, заказов и финансовых операций, а также генерация отчетов и дашбордов.**Важное примечание:** В реальных высоконагруженных системах Analytics & Reporting Service часто не имеет собственной операционной БД, а работает с аналитическим хранилищем данных (DWH) или озером данных, собирая информацию из событийных стримов (Kafka/RabbitMQ) или CDC (Change Data Capture). Для MVP, тем не менее, можем предположить наличие локальной БД для хранения агрегатов и метрик, если нет полноценного DWH.**Сущности и их Атрибуты:**

#### **1. Сущность: AggregatedMetric (Агрегированные метрики)**

- **MetricID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
    - **Примечания:** Уникальный идентификатор метрики.
- **MetricName**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Имя метрики (например, 'TOTAL_REGISTERED_USERS', 'TOTAL_ORDERS_PLACED', 'AVG_ORDER_LIFETIME_DAYS').
- **AggregationPeriod**
    - **Тип данных:**VARCHAR(50) (ENUM: 'DAILY', 'WEEKLY', 'MONTHLY', 'TOTAL')
    - **Обязательность:**NOT NULL
    - **Примечания:** Период агрегации (например, дневная, недельная, месячная сумма, или общая за все время).
- **PeriodStart**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Начало периода агрегации.
- **PeriodEnd**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Конец периода агрегации.
- **ValueNumeric**
    - **Тип данных:**DECIMAL(18, 2) (или BIGINT для целых чисел)
    - **Обязательность:**NULL
    - **Примечания:** Числовое значение метрики.
- **ValueString**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Строковое значение метрики (если метрика не числовая, например, "самая популярная технология").
- **RelatedUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID пользователя, если метрика привязана к конкретному пользователю.
- **RelatedOrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID заказа, если метрика привязана к конкретному заказу.
- **LastUpdated**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Время последнего обновления метрики.
- **Ключ:**UNIQUE Constraint на (MetricName, AggregationPeriod, PeriodStart, RelatedUserID, RelatedOrderID) для уникальности агрегированных данных.

#### **2. Сущность: RawEventLog (Журнал сырых событий)**

- **EventID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **EventType**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип события (например, 'UserRegisteredEvent', 'OrderPlacedEvent', 'PaymentProcessedEvent', 'NewMessageEvent', 'TicketCreatedEvent').
- **EventTimestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID пользователя, связанного с событием.
- **OrderID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID заказа, связанного с событием.
- **Payload**
    - **Тип данных:**JSONB (если БД поддерживает JSON) или TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Полные данные события в формате JSON.
- **SourceService**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Примечания:** Сервис, опубликовавший событие.
- **ProcessedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
    - **Примечания:** Время, когда событие было обработано аналитическим сервисом.

#### **3. Сущность: ReportDefinition (Определения для генерации отчетов)**

- **ReportDefID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **ReportName**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Название отчета (например, "Ежедневная активность пользователей", "Выручка за месяц").
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
- **QueryParameters**
    - **Тип данных:**JSONB (или TEXT)
    - **Обязательность:**NULL
    - **Примечания:** Параметры, необходимые для генерации отчета (например, {"period": "monthly", "userType": "freelancer"}).
- **OutputFormat**
    - **Тип данных:**VARCHAR(50) (ENUM: 'CSV', 'JSON', 'PDF')
    - **Обязательность:**NOT NULL
- **AccessRole**
    - **Тип данных:**VARCHAR(50) (ENUM: 'ADMIN', 'SUPPORT')
    - **Обязательность:**NOT NULL
    - **Примечания:** Роль, которая имеет доступ к этому отчету (логическая ссылка на Role.RoleName в Roles Service).
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

**Взаимосвязи внутри Analytics & Reporting Service:**

- RawEventLog (много) --- (много) AggregatedMetric (Сырые события агрегируются в метрики, но это не прямая FK, а процесс трансформации данных).
- ReportDefinition (1) --- (много) AggregatedMetric (Один отчет может использовать много агрегированных метрик для своей генерации).

### **Проектирование Базы Данных: Admin Service**

**Назначение сервиса:** Управление общими настройками платформы (комиссии, стоимость публикации), персоналом поддержки, модерационными действиями администраторов, а также справочными данными.**Сущности и их Атрибуты:**

#### **1. Сущность: PlatformSetting (Общие настройки платформы)**

- **SettingID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **SettingKey**
    - **Тип данных:**VARCHAR(100)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** Уникальный ключ настройки (например, 'PLATFORM_COMMISSION_PERCENT', 'ORDER_PUBLICATION_FEE', 'SUPPORT_ESCALATION_THRESHOLD').
- **SettingValue**
    - **Тип данных:**TEXT
    - **Обязательность:**NOT NULL
    - **Примечания:** Значение настройки (может быть числом, строкой, JSON-объектом).
- **DataType**
    - **Тип данных:**VARCHAR(50) (ENUM: 'STRING', 'NUMBER', 'BOOLEAN', 'JSON')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип данных, для корректной валидации и отображения.
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
    - **Примечания:** Описание назначения настройки.
- **LastUpdatedByUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID администратора, который последний раз менял настройку (логическая ссылка на UserProfile.UserID).
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **2. Сущность: ModerationLog (Действия администраторов/модераторов)**

- **LogID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **ActorUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Indexed
    - **Примечания:** ID администратора/сотрудника, совершившего действие (логическая ссылка на UserProfile.UserID).
- **ActionType**
    - **Тип данных:**VARCHAR(100) (ENUM: 'USER_BLOCK', 'USER_UNBLOCK', 'USER_DELETE', 'TICKET_ESCALATION_FINAL_DECISION', 'REVIEW_DELETED_OVERRIDE', 'PLATFORM_SETTING_UPDATE', 'REFERENCE_DATA_UPDATE')
    - **Обязательность:**NOT NULL
- **TargetUserID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID пользователя, на которого было направлено действие (если применимо).
- **TargetEntityID**
    - **Тип данных:** UUID
    - **Обязательность:**NULL
    - **Примечания:** ID любой другой сущности, на которую было направлено действие (например, TicketID, ReviewID).
- **Details**
    - **Тип данных:**TEXT (или JSONB)
    - **Обязательность:**NULL
    - **Примечания:** Дополнительные детали действия, причина.
- **Timestamp**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **3. Сущность: StaffMember (Сотрудники службы поддержки)**

- **StaffID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **UserID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index
    - **Примечания:** ID пользователя, который является сотрудником (логическая ссылка на UserProfile.UserID).
- **RoleInSupport**
    - **Тип данных:**VARCHAR(50) (ENUM: 'AGENT', 'SENIOR_AGENT', 'MANAGER')
    - **Обязательность:**NOT NULL
    - **Примечания:** Роль сотрудника внутри отдела поддержки (может отличаться от общей роли SUPPORT из Roles Service).
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
- **AssignedTicketCount**
    - **Тип данных:**INTEGER
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**0
    - **Примечания:** Количество обращений, назначенных на сотрудника в данный момент (для балансировки нагрузки).
- **LastActivityAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NULL
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

#### **4. Сущность: ReferenceData (Справочники: технологии, категории, стили)**

- **ReferenceDataID**
    - **Тип данных:** UUID
    - **Обязательность:**NOT NULL
    - **Ключ:**Primary Key (PK)
- **DataType**
    - **Тип данных:**VARCHAR(100) (ENUM: 'TECHNOLOGY', 'CATEGORY', 'STYLE')
    - **Обязательность:**NOT NULL
    - **Примечания:** Тип справочных данных.
- **Value**
    - **Тип данных:**VARCHAR(255)
    - **Обязательность:**NOT NULL
    - **Ключ:**UNIQUE Index на (DataType, Value)
    - **Примечания:** Значение справочника (например, "React", "Mobile Development", "Minimalistic").
- **Description**
    - **Тип данных:**TEXT
    - **Обязательность:**NULL
- **IsActive**
    - **Тип данных:**BOOLEAN
    - **Обязательность:**NOT NULL
    - **Значение по умолчанию:**TRUE
- **CreatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL
- **UpdatedAt**
    - **Тип данных:**DATETIME
    - **Обязательность:**NOT NULL

**Взаимосвязи внутри Admin Service:**

- StaffMember (много) --- (много) ModerationLog (Сотрудники делают записи в лог, но это не прямая FK, а логическая связь по ActorUserID).
- PlatformSetting (1) --- (1) (Это скорее singleton-сущность, где одна строка для каждой настройки).
- ReferenceData (много) --- (1) (Справочные данные, управляемые администратором).